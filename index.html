<!doctype html>
<html lang="en">

<head>

  <title>COVID-19 Vaccination Dashboard | MSBD5005 Project [Group: World Peace]</title>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" href="favicon.ico" />

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css"
        integrity="sha512-P5MgMn1jBN01asBgU0z60Qk4QxiXo86+wlFahKrsQf37c9cro517WzVSPPV1tDKzhku2iJ2FVgL67wG03SGnNA=="
        crossorigin="anonymous"/>
  <link rel="stylesheet" href="assets/custom.css">

</head>

<body>

<nav class="navbar navbar-expand navbar-dark bg-dark">
  <a class="navbar-brand" href="#">COVID-19 Vaccination Dashboard <sup>[©️ 2021 World Peace]</sup></a>
</nav>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">About the project</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>This is a course project for MSBD5005 Data Visualization (2020-2021 Academic Year). Showing the global
          progress of the COVID-19 Vaccination.</p>
        <p>Data Sources</p>
        <ul>
          <li>COVID-19 World Vaccination Progress - <a
            href="https://www.kaggle.com/gpreda/covid-world-vaccination-progress">Kaggle</a></li>
          <li>COVID-19 TREATMENT AND VACCINE TRACKER - <a href="https://milkeninstitute.org/centers/fastercures">FasterCures
            @ Milken Institute</a></li>
          <li>COVAX first round of allocations - <a
            href="https://www.who.int/news/item/02-03-2021-covax-publishes-first-round-of-allocations">WHO</a></li>
        </ul>
        <p>Tools: D3.js, split.js, Bootstrap, Python</p>
        <p>Group Members</p>
        <ul>
          <li>WU Zhenghao</li>
          <li>GU Xianggao</li>
          <li>XING Zhenghao</li>
          <li>USMANI Muhammad Adam</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<div id="hover">
  <div class="card">
    <div class="card-header" id="nation-name">
      National
    </div>
    <div class="card-body">
      <div id="detail" style="width: 350px;"></div>
    </div>
  </div>
</div>

<div class="container-fluid px-0">
  <div id="top-row" class="d-flex">
    <div id="tlh-col" class="split content">
      <div id="home-view" class="full-size">
<!--        <div class="d-flex full-size">-->
          <!--          <img src="percentage-of-vaccinatio.svg" class="img-fluid" alt="Responsive image">-->
          <div id="map" class="full-size"></div>
<!--        </div>-->
      </div>
      <div id="progress-view" class="d-none full-size">
        <div id="c2" class="full-size"></div>
      </div>
      <div id="distribution-view" class="d-none full-size">
        <nav>
          <div class="nav nav-tabs" id="nav-dist-tab" role="tablist">
            <a class="nav-link active" id="nav-dist-continent-tab" data-toggle="tab" href="#nav-dist-continent"
               role="tab" aria-controls="nav-dist-continent" aria-selected="true"
               onclick="draw_dist_cont();">Continent</a>
            <a class="nav-link" id="nav-dist-treemap-tab" data-toggle="tab" href="#nav-dist-treemap" role="tab"
               aria-controls="nav-dist-treemap" aria-selected="false" onclick="draw_tree_map();">Treemap</a>
          </div>
        </nav>
        <div class="tab-content" id="nav-dist-tabContent" style="width: 100%">
          <div class="tab-pane fade show active" id="nav-dist-continent" role="tabpanel" aria-labelledby="nav-home-tab">
            <!--            <img src="https://source.unsplash.com/random" class="img-fluid mx-auto d-block" alt="Responsive image">-->
            <div id="distribution-continent"></div>
          </div>
          <div class="tab-pane fade" id="nav-dist-treemap" role="tabpanel" aria-labelledby="nav-profile-tab">
            <div id="distribution-treemap"></div>
            <!--            <img src="https://source.unsplash.com/user/erondu" class="img-fluid mx-auto d-block" alt="Responsive image">-->
          </div>
        </div>
      </div>
      <div id="solution-view" class="d-none full-size">
<!--        <div id="solution" class="full-size"></div>-->
        Solutions:
        <button type="button" class="btn btn-info" onclick="draw_solution_case();">Total Cases</button>
        <button type="button" class="btn btn-primary" onclick="draw_solution_newcase();">New Cases</button>
        <button type="button" class="btn btn-success" onclick="draw_solution_population();">Population</button>
        <div id="solution-map" class="full-size"></div>
      </div>
    </div>

    <div id="trh-col" class="split content">
<!--      <img src="vacc-info.png" class="img-fluid" alt="Responsive image">-->
      <div id="vaccine-view" class="full-size">
        <nav>
          <div class="nav nav-tabs" id="nav-vacc-tab" role="tablist">
            <a class="nav-link active" id="nav-vacc-phase-tab" data-toggle="tab"
               href="#nav-vacc-phase" role="tab" aria-controls="nav-vacc-phase" aria-selected="true" onclick="draw_vacc_phases();">Phases</a>
            <a class="nav-link" id="nav-vacc-bar-tab" data-toggle="tab" href="#nav-vacc-bar" role="tab"
               aria-controls="nav-vacc-bar" aria-selected="false" onclick="draw_vacc_stacked();">Platform</a>
          </div>
        </nav>
        <div class="tab-content" id="nav-vacc-tabContent" style="width: 100%">
          <div class="tab-pane fade show active" id="nav-vacc-phase" role="tabpanel"
               aria-labelledby="nav-vacc-phase-tab">
            <div id="phases"></div>
          </div>
          <div class="tab-pane fade" id="nav-vacc-bar" role="tabpanel" aria-labelledby="nav-vacc-bar-tab">
<!--            <img src="https://source.unsplash.com/collection/190727" class="img-fluid mx-auto d-block"-->
<!--                 alt="Responsive image">-->
            <div id="vacc-stacked"></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div id="bottom-row" class="d-flex align-items-center justify-content-center ">

    <div class="d-flex">
      <div class="d-flex flex-wrap">
        <ul class="nav col-12 col-lg-auto my-2 justify-content-center my-md-0 text-small">
          <li>
            <a href="#" class="nav-link text-dark" onclick="switchView('home-view'); draw_mainmap();">
              <svg class="bi d-block mx-auto mb-1" width="24" height="24">
                <svg id="home" viewBox="0 0 16 16">
                  <path
                    d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"></path>
                </svg>
              </svg>
              Home
            </a>
          </li>
          <li>
            <a href="#" class="nav-link text-dark" onclick="switchView('progress-view'); draw_overtrend();">
              <svg class="bi d-block mx-auto mb-1" width="24" height="24">
                <svg id="speedometer2" viewBox="0 0 16 16">
                  <path
                    d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4zM3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.389.389 0 0 0-.029-.518z"></path>
                  <path fill-rule="evenodd"
                        d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A7.988 7.988 0 0 1 0 10zm8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3z"></path>
                </svg>
              </svg>
              Progress
            </a>
          </li>
          <li>
            <div class="dropdown">
              <a href="#" class="nav-link text-dark" onclick="switchView('distribution-view'); draw_dist_cont();">
                <svg class="bi d-block mx-auto mb-1" width="24" height="24">
                  <svg id="table" viewBox="0 0 16 16">
                    <path
                      d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"></path>
                  </svg>
                </svg>
                Distribution
              </a>
            </div>
          </li>
          <li>
            <div class="dropdown">
              <a href="#" class="nav-link text-dark" onclick="switchView('solution-view');">
                <svg class="bi d-block mx-auto mb-1" width="24" height="24">
                  <svg id="grid" viewBox="0 0 16 16">
                    <path
                      d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"></path>
                  </svg>
                </svg>
                Solution
              </a>
            </div>
          </li>
          <li>
            <a href="#" class="nav-link text-dark" data-toggle="modal" data-target="#exampleModal">
              <svg class="bi d-block mx-auto mb-1" width="24" height="24">
                <svg id="people-circle" viewBox="0 0 16 16">
                  <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"></path>
                  <path fill-rule="evenodd"
                        d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"></path>
                </svg>
              </svg>
              About
            </a>
          </li>
        </ul>
      </div>
    </div>

  </div>
</div>


<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"
        integrity="sha512-XKa9Hemdy1Ui3KSGgJdgMyYlUg1gM+QhL6cnlyTe2qzMCYm4nAZ1PsVerQzTTXzonUR+dmswHqgJPuwCq1MaAg=="
        crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.5.11/split.min.js"></script>


<script src="assets/script.js"></script>

<script src="https://gw.alipayobjects.com/os/lib/antv/g2/4.1.13/dist/g2.min.js"></script>
<script src="https://unpkg.com/@antv/data-set@0.11.8/build/data-set.js"></script>
<script type="text/javascript" src="https://unpkg.com/@antv/g2plot@latest/dist/g2plot.min.js"></script>
<script>
    // Reserved function for EndDrag callback, update the layout for top figures
    let topMainViewFigure = null
    let topSecViewFigure = null
    function endDragUpdate(){
        if (topMainViewFigure !== null) {
            topMainViewFigure();
        }
        if (topSecViewFigure !== null) {
            topSecViewFigure();
        }
    }
</script>
<script>
    // Graph for overall trend of vaccination
    function draw_overtrend() {
        topMainViewFigure = draw_overtrend
        $("#c2").html("")
        fetch('processed.json')
            .then(res => res.json())
            .then(data => {
                const ds = new DataSet.DataSet();
                const dv = ds.createView().source(data);
                dv.transform({
                    type: 'sort',
                    callback(a, b) {
                        return a.day - b.day;
                    }
                });
                const trend_chart = new G2.Chart({
                    container: 'c2',
                    autoFit: true,
                    height: 1500,
                    padding: [20, 10, 20, 20]
                });

                trend_chart.data(dv.rows);

                trend_chart.scale({
                    people_vaccinated_per_hundred: {
                        min: 0,
                        max: 55,
                    },
                    day: {
                        range: [0, 1],
                        ticks: ['0', '86']
                    }
                });

                trend_chart.axis('day', {
                    grid: {
                        line: {
                            style: {
                                lineDash: [0, 0],
                                lineWidth: 1,
                                stroke: '#e9e9e9'
                            }
                        }
                    },
                    label: {
                        rotate: Math.PI / 4,
                    }
                });

                trend_chart.tooltip({
                    showCrosshairs: true,
                    // shared: true,
                    showTitle: false
                });

                trend_chart.facet('list', {
                    fields: ['country'],
                    cols: 22,
                    columnTitle: {
                        style: {
                            fontSize: 12,
                            textAlign: 'center',
                            fontWeight: 300,
                            fill: '#8d8d8d'
                        }
                    },
                    showTitle: false,
                    padding: [5, 5, 5, 5],
                    eachView: (view, facet) => {
                        view.line()
                            .position('day*people_vaccinated_per_hundred')
                            .shape('smooth')
                            .style({opacity: 0.8})
                            .tooltip('country*day*people_vaccinated_per_hundred');
                    },
                });
                trend_chart.render();
            });
    }
</script>
<script>
    // Code for distribution pie chart
    const data = [
        {name: 'Asia', value: 4641054775, vaccine: 0.10},
        {name: 'Africa', value: 1340598147, vaccine: 0.013},
        {name: 'Europe', value: 747636026, vaccine: 0.28},
        {name: 'Oceania', value: 43111704, vaccine: 0.051},
        {name: 'North America', value: 592072212, vaccine: 0.45},
        {name: 'South America', value: 430759766, vaccine: 0.16},
    ];


    let max = 1;

    // 自定义 other 的图形，增加两条线
    G2.registerShape('interval', 'slice-shape', {
        draw(cfg, container) {
            const points = cfg.points;
            const origin = cfg.data;
            const percent = origin.vaccine / max;
            const xWidth = points[2].x - points[1].x;
            let width = xWidth;

            const group = container.addGroup();

            let path = [];
            const offset = 0.65
            path.push(['M', points[0].x + offset, points[0].y]);
            path.push(['L', points[1].x + offset, points[1].y]);
            path.push(['L', points[0].x + width, points[2].y]);
            path.push(['L', points[0].x + width, points[3].y]);
            path.push('Z');
            path = this.parsePath(path)

            group.addShape('path', {
                attrs: {
                    // stroke: 'l(0) 0:#ffffff 0.85:#ffffff 1:#000000',
                    stroke: '#000000',
                    strokeOpacity: 0.2,
                    lineWidth: 1,
                    path,
                },
            })

            width = xWidth * percent * 0.5;

            path = [];

            path.push(['M', points[0].x + offset, points[0].y]);
            path.push(['L', points[1].x + offset, points[1].y]);
            path.push(['L', points[0].x + width + offset, points[2].y]);
            path.push(['L', points[0].x + width + offset, points[3].y]);
            path.push('Z');
            path = this.parsePath(path)

            group.addShape('path', {
                attrs: {
                    fill: cfg.color,
                    stroke: '#929292',
                    lineWidth: 0,
                    path,
                },
            })

            return group
        },
    });


    function draw_dist_cont() {
        topMainViewFigure = draw_dist_cont
        $("#distribution-continent").html("")
        const chart = new G2.Chart({
            container: 'distribution-continent',
            autoFit: true,
            height: 800,
        });

        // dist_chart.clear();

        chart.coordinate('theta', {
            radius: 0.75,
        });

        // chart.coordinate({
        //     radius: 0.75,
        // });

        chart.data(data);

        chart.tooltip({
            showTitle: false,
            showMarkers: false,
        });

        chart.interval()
            .adjust('stack')
            .position('value')
            .color('name')
            .shape('slice-shape')
            .style({
                stroke: '#c6c6c6',
                lineWidth: 3,
            })
            .label('name', {
                offset: '20%',
                layout: {
                    type: 'fixed-overlap',
                },
                background: {
                    style: {
                        fill: '#fff',
                        fillOpacity: '0.25',
                        radius: 2,
                    },
                    padding: 5,
                },
                content: (obj) => {
                    return obj.name + "\nVaccination: " + obj.vaccine * 100 + "%" + "\nPopulation: " + obj.value;
                },
            });

        chart.annotation().text({
            position: ['50%', '50%'],
            content: 'Total Vaccination (Global)\n8.7%',
            style: {
                fontSize: 20,
                fill: '#8c8c8c',
                textAlign: 'center',
            },
        });

        chart.interaction('element-active');

        chart.render();
    }
</script>
<script>
    // Code for distribution treemap chart
    function draw_tree_map() {
        topMainViewFigure = draw_tree_map
        $("#distribution-treemap").html("");
        fetch('treemap-data.json')
            .then((res) => res.json())
            .then((mobiles) => {
                const {DataView} = new DataSet.DataSet;
                // 会通过子节点累加 value 值，所以设置为 0
                mobiles.forEach(function (mobile) {
                    mobile.value = null;
                });
                const data = {
                    name: 'root',
                    children: mobiles,
                };
                const dv = new DataSet.DataView();
                dv.source(data, {
                    type: 'hierarchy',
                }).transform({
                    field: 'value',
                    type: 'hierarchy.treemap',
                    tile: 'treemapResquarify',
                    as: ['x', 'y'],
                });
                // 将 DataSet 处理后的结果转换为 G2 接受的数据
                const nodes = [];
                for (const node of dv.getAllNodes()) {
                    if (!node.children) {
                        const eachNode = {
                            name: node.data.name,
                            x: node.x,
                            y: node.y,
                            depth: node.depth,
                            value: node.value,
                        };
                        if (!node.data.brand && node.parent) {
                            eachNode.brand = node.parent.data.brand;
                        } else {
                            eachNode.brand = node.data.brand;
                        }

                        nodes.push(eachNode);
                    }
                }
                const chart = new G2.Chart({
                    container: 'distribution-treemap',
                    autoFit: true,
                    height: 650,
                    padding: 0,
                });
                chart.coordinate().scale(1, -1); // 习惯性最小的在最下面
                chart.data(nodes);
                chart.axis(false);
                chart.legend(false);
                chart.tooltip({
                    showTitle: false,
                    showMarkers: false
                });
                chart
                    .polygon()
                    .position('x*y')
                    .color('brand')
                    .tooltip('name*value', function (name, value) {
                        return {
                            name,
                            value,
                        };
                    })
                    .style({
                        lineWidth: 1,
                        stroke: '#fff',
                    })
                    .label(
                        'name',
                        {
                            offset: 0,
                            style: {
                                textBaseline: 'middle',
                                fill: '#000',
                                shadowBlur: 10,
                                shadowColor: '#fff',
                            },
                            layout: {
                                type: 'limit-in-shape'
                            }
                        }
                    );
                chart.interaction('element-active');
                chart.render();
            });
    }
</script>
<script type="text/javascript" src="detailData.js"></script>
<script type="text/javascript" src="userData.js"></script>
<script>
    function draw_mainmap(){
        topMainViewFigure = draw_mainmap
        $("#map").html("")
        fetch('https://gw.alipayobjects.com/os/antvdemo/assets/data/world.geo.json')
            .then(res => res.json())
            .then(mapData => {
                const chart = new G2.Chart({
                    container: 'map',
                    autoFit: true,
                    height: 700,
                });
                chart.tooltip({
                    showTitle: false,
                    showMarkers: false,
                    shared: true,
                });
                // 同步度量
                chart.scale({
                    longitude: {
                        sync: true
                    },
                    latitude: {
                        sync: true
                    }
                });
                chart.axis(false);
                chart.legend('trend', {
                    position: 'right'
                });

                chart.on('element:click', (ev) => {
                    $("#hover").css({
                        position: "absolute",
                        marginLeft: 0, marginTop: 0,
                        top: ev.y, left: ev.x
                    }).show()
                    $("#detail").html("")
                    $("#nation-name").html(ev.data.data.name)

                    const detail = new G2.Chart({
                        container: 'detail',
                        autoFit: true,
                        height: 150,
                    });

                    // console.log(detailData)

                    const country = new DataSet.DataView().source(detailData);
                    country.transform({
                        type: 'filter',
                        callback(row) {
                            return row.name == ev.data.data.name;
                        },
                    });
                    // console.log(country.rows)

                    detail.source(country.rows);

                    detail.scale('case', {
                        nice: true,
                        type: 'log',
                    });

                    detail.tooltip({
                        showMarkers: false
                    });
                    detail.interaction('active-region');

                    detail.line().position('year*case').color('type');

                    detail.render(isUpdate=true);
                })

                chart.on('element:mouseover', (ev) => {
                    $("#hover").hide()
                })

                // 绘制世界地图背景
                const ds = new DataSet();

                const worldMap = ds.createView('back')
                    .source(mapData, {
                        type: 'GeoJSON'
                    });
                const worldMapView = chart.createView();
                worldMapView.data(worldMap.rows);
                worldMapView.tooltip(false);
                worldMapView.polygon().position('longitude*latitude').style({
                    fill: '#fff',
                    stroke: '#ccc',
                    lineWidth: 1
                });

                // 可视化用户数据
                const userDv = ds.createView()
                    .source(userData)
                    .transform({
                        geoDataView: worldMap,
                        field: 'name',
                        type: 'geo.region',
                        as: ['longitude', 'latitude']
                    });

                // console.log(userDv.rows);

                const userView = chart.createView();
                userView.data(userDv.rows);
                userView.scale({
                    name: {
                        alias: 'Country / Region'
                    }
                });
                userView.scale({
                    tvalue: {
                        alias: 'Active Cases'
                    }
                });
                chart.scale('tvalue', {
                    type: 'log',
                });
                userView.scale({
                    tvacc: {
                        alias: 'Vaccination'
                    }
                });
                userView.polygon()
                    .position('longitude*latitude')
                    .color('tvalue', [
                            "#B8E1FF",
                            "#9AC5FF",
                            "#7DAAFF",
                            "#5B8FF9",
                            "#3D76DD",
                            "#085EC0",
                            "#0047A5",
                            "#00318A",
                            "#001D70"
                        ]
                    )
                    .tooltip('name*tvacc*tvalue')
                    .style({
                        fillOpacity: 0.85
                    })
                    .animate({
                        leave: {
                            animation: 'fade-out'
                        }
                    });
                userView.interaction('element-active');

                chart.render();
            });
    }
    draw_mainmap()
</script>
<script type="text/javascript" src="xzh/detailData_cases.js"></script>
<script type="text/javascript" src="xzh/userData_cases.js"></script>
<script type="text/javascript" src="xzh/detailData_newcases.js"></script>
<script type="text/javascript" src="xzh/userData_newcases.js"></script>
<script type="text/javascript" src="xzh/detailData_population.js"></script>
<script type="text/javascript" src="xzh/userData_population.js"></script>
<script>
    function draw_solution_prepare(){
        $("#solution-map").html("")
    }
    function draw_solution_case(){
        topMainViewFigure = draw_solution_case
        draw_solution_prepare();
        fetch('https://gw.alipayobjects.com/os/antvdemo/assets/data/world.geo.json')
            .then(res => res.json())
            .then(mapData => {
                const chart = new G2.Chart({
                    container: 'solution-map',
                    autoFit: true,
                    height: 700,
                });
                chart.tooltip({
                    showTitle: false,
                    showMarkers: false,
                    shared: true,
                });
                // 同步度量
                chart.scale({
                    longitude: {
                        sync: true
                    },
                    latitude: {
                        sync: true
                    }
                });
                chart.axis(false);
                chart.legend('trend', {
                    position: 'right'
                });

                chart.on('element:click', (ev) => {
                    $("#hover").css({
                        position: "absolute",
                        marginLeft: 0, marginTop: 0,
                        top: ev.y, left: ev.x
                    }).show()
                    $("#detail").html("")
                    $("#nation-name").html(ev.data.data.name)

                    // console.log(ev.data.data.name);
                    const detail = new G2.Chart({
                        container: 'detail',
                        autoFit: true,
                        height: 150,
                    });

                    const country = new DataSet.DataView().source(CdetailData);
                    country.transform({
                        type: 'filter',
                        callback(row) {
                            return row.name == ev.data.data.name;
                        },
                    });
                    // console.log(country.rows)

                    detail.source(country.rows);

                    detail.scale('value', {
                        nice: true,
                    });

                    detail.tooltip({
                        showMarkers: false
                    });
                    detail.interaction('active-region');

                    detail.interval().position('type*value').color('type');

                    detail.render(isUpdate=true);
                })

                chart.on('element:mouseover', (ev) => {
                    $("#hover").hide()
                })

                // 绘制世界地图背景
                const ds = new DataSet();

                const worldMap = ds.createView('back')
                    .source(mapData, {
                        type: 'GeoJSON'
                    });
                const worldMapView = chart.createView();
                worldMapView.data(worldMap.rows);
                worldMapView.tooltip(false);
                worldMapView.polygon().position('longitude*latitude').style({
                    fill: '#fff',
                    stroke: '#ccc',
                    lineWidth: 1
                });

                // 可视化用户数据

                const userDv = ds.createView()
                    .source(CuserData)
                    .transform({
                        geoDataView: worldMap,
                        field: 'name',
                        type: 'geo.region',
                        as: ['longitude', 'latitude']
                    });

                // console.log(userDv.rows);

                const userView = chart.createView();
                userView.data(userDv.rows);
                userView.scale({
                    name: {
                        alias: 'Country / Region'
                    }
                });
                userView.scale({
                    cases: {
                        alias: 'Cases'
                    }
                });
                userView.scale({
                    vacc: {
                        alias: 'Vaccination'
                    }
                });
                userView.scale({
                    vaccRate: {
                        alias: 'Vaccination Rate'
                    }
                });
                userView.scale({
                    population: {
                        alias: 'Population'
                    }
                });
                userView.scale({
                    populationRate: {
                        alias: 'Population Rate'
                    }
                });

                userView.scale({
                    RawPRateOnVRate: {
                        alias: 'Population Over Vaccination Rate'
                    }
                });

                userView.scale({
                    RawCRateOnVRate: {
                        alias: 'Cases Over Vaccination Rate'
                    }
                });
                userView.scale({
                    PRateMinusVRate: {
                        alias: 'Population minus Vaccination Rate'
                    }
                });

                userView.scale({
                    CRateMinusVRate: {
                        alias: 'Cases minus Vaccination Rate'
                    }
                });

                userView.scale({
                    casesRate: {
                        alias: 'Cases Rate'
                    }
                });

                userView.polygon()
                    .position('longitude*latitude')
                    .color('CRateMinusVRate', ['#008A5D','#ffffff','#F51D27'])
                    .tooltip('name*cases*casesRate*vacc*vaccRate*population*populationRate*CRateMinusVRate')
                    .style({
                        fillOpacity: 0.85
                    })
                    .animate({
                        leave: {
                            animation: 'fade-out'
                        }
                    });
                userView.interaction('element-active');

                chart.render();
            });
    }

    function draw_solution_newcase(){
        topMainViewFigure = draw_solution_newcase
        draw_solution_prepare();
        fetch('https://gw.alipayobjects.com/os/antvdemo/assets/data/world.geo.json')
            .then(res => res.json())
            .then(mapData => {
                const chart = new G2.Chart({
                    container: 'solution-map',
                    autoFit: true,
                    height: 700,
                });
                chart.tooltip({
                    showTitle: false,
                    showMarkers: false,
                    shared: true,
                });
                // 同步度量
                chart.scale({
                    longitude: {
                        sync: true
                    },
                    latitude: {
                        sync: true
                    }
                });
                chart.axis(false);
                chart.legend('trend', {
                    position: 'right'
                });

                chart.on('element:click', (ev) => {
                    $("#hover").css({
                        position: "absolute",
                        marginLeft: 0, marginTop: 0,
                        top: ev.y, left: ev.x
                    }).show()
                    $("#detail").html("")
                    $("#nation-name").html(ev.data.data.name)

                    // console.log(ev.data.data.name);
                    const detail = new G2.Chart({
                        container: 'detail',
                        autoFit: true,
                        height: 150,
                    });

                    const country = new DataSet.DataView().source(NdetailData);
                    country.transform({
                        type: 'filter',
                        callback(row) {
                            return row.name == ev.data.data.name;
                        },
                    });
                    // console.log(country.rows)

                    detail.source(country.rows);

                    detail.scale('value', {
                        nice: true,
                    });

                    detail.tooltip({
                        showMarkers: false
                    });
                    detail.interaction('active-region');

                    detail.interval().position('type*value').color('type');

                    detail.render(isUpdate=true);
                })

                chart.on('element:mouseover', (ev) => {
                    $("#hover").hide()
                })

                // 绘制世界地图背景
                const ds = new DataSet();

                const worldMap = ds.createView('back')
                    .source(mapData, {
                        type: 'GeoJSON'
                    });
                const worldMapView = chart.createView();
                worldMapView.data(worldMap.rows);
                worldMapView.tooltip(false);
                worldMapView.polygon().position('longitude*latitude').style({
                    fill: '#fff',
                    stroke: '#ccc',
                    lineWidth: 1
                });

                // 可视化用户数据

                const userDv = ds.createView()
                    .source(NuserData)
                    .transform({
                        geoDataView: worldMap,
                        field: 'name',
                        type: 'geo.region',
                        as: ['longitude', 'latitude']
                    });

                // console.log(userDv.rows);

                const userView = chart.createView();
                userView.data(userDv.rows);
                userView.scale({
                    name: {
                        alias: 'Country / Region'
                    }
                });
                userView.scale({
                    cases: {
                        alias: 'Cases'
                    }
                });
                userView.scale({
                    vacc: {
                        alias: 'Vaccination'
                    }
                });
                userView.scale({
                    vaccRate: {
                        alias: 'Vaccination Rate'
                    }
                });
                userView.scale({
                    population: {
                        alias: 'Population'
                    }
                });
                userView.scale({
                    populationRate: {
                        alias: 'Population Rate'
                    }
                });

                userView.scale({
                    RawPRateOnVRate: {
                        alias: 'Population Over Vaccination Rate'
                    }
                });

                userView.scale({
                    RawCRateOnVRate: {
                        alias: 'Cases Over Vaccination Rate'
                    }
                });
                userView.scale({
                    PRateMinusVRate: {
                        alias: 'Population minus Vaccination Rate'
                    }
                });

                userView.scale({
                    CRateMinusVRate: {
                        alias: 'Cases minus Vaccination Rate'
                    }
                });

                userView.scale({
                    newCases: {
                        alias: 'New Cases'
                    }
                });

                userView.scale({
                    newCasesRate: {
                        alias: 'New Cases Rate'
                    }
                });

                userView.scale({
                    NewCRateMinusVRate: {
                        alias: 'New Cases minus Vaccination Rate'
                    }
                });

                userView.scale({
                    casesRate: {
                        alias: 'Cases Rate'
                    }
                });


                userView.polygon()
                    .position('longitude*latitude')
                    .color('NewCRateMinusVRate', ['#008A5D','#ffffff','#F51D27'])
                    .tooltip('name*cases*casesRate*vacc*vaccRate*population*populationRate*newCases*newCasesRate*NewCRateMinusVRate')
                    .style({
                        fillOpacity: 0.85
                    })
                    .animate({
                        leave: {
                            animation: 'fade-out'
                        }
                    });
                userView.interaction('element-active');

                chart.render();
            });
    }

    function draw_solution_population(){
        topMainViewFigure = draw_solution_population
        draw_solution_prepare();
        fetch('https://gw.alipayobjects.com/os/antvdemo/assets/data/world.geo.json')
            .then(res => res.json())
            .then(mapData => {
                const chart = new G2.Chart({
                    container: 'solution-map',
                    autoFit: true,
                    height: 700,
                });
                chart.tooltip({
                    showTitle: false,
                    showMarkers: false,
                    shared: true,
                });
                // 同步度量
                chart.scale({
                    longitude: {
                        sync: true
                    },
                    latitude: {
                        sync: true
                    }
                });
                chart.axis(false);
                chart.legend('trend', {
                    position: 'right'
                });

                chart.on('element:click', (ev) => {
                    $("#hover").css({
                        position: "absolute",
                        marginLeft: 0, marginTop: 0,
                        top: ev.y, left: ev.x
                    }).show()
                    $("#detail").html("")
                    $("#nation-name").html(ev.data.data.name)

                    // console.log(ev.data.data.name);
                    const detail = new G2.Chart({
                        container: 'detail',
                        autoFit: true,
                        height: 150,
                    });

                    const country = new DataSet.DataView().source(PdetailData);
                    country.transform({
                        type: 'filter',
                        callback(row) {
                            return row.name == ev.data.data.name;
                        },
                    });
                    // console.log(country.rows)

                    detail.source(country.rows);

                    detail.scale('value', {
                        nice: true,
                    });

                    detail.tooltip({
                        showMarkers: false
                    });
                    detail.interaction('active-region');

                    detail.interval().position('type*value').color('type');

                    detail.render(isUpdate=true);
                })

                chart.on('element:mouseover', (ev) => {
                    $("#hover").hide()
                })

                // 绘制世界地图背景
                const ds = new DataSet();

                const worldMap = ds.createView('back')
                    .source(mapData, {
                        type: 'GeoJSON'
                    });
                const worldMapView = chart.createView();
                worldMapView.data(worldMap.rows);
                worldMapView.tooltip(false);
                worldMapView.polygon().position('longitude*latitude').style({
                    fill: '#fff',
                    stroke: '#ccc',
                    lineWidth: 1
                });

                // 可视化用户数据

                const userDv = ds.createView()
                    .source(PuserData)
                    .transform({
                        geoDataView: worldMap,
                        field: 'name',
                        type: 'geo.region',
                        as: ['longitude', 'latitude']
                    });

                // console.log(userDv.rows);

                const userView = chart.createView();
                userView.data(userDv.rows);
                userView.scale({
                    name: {
                        alias: 'Country / Region'
                    }
                });
                userView.scale({
                    cases: {
                        alias: 'Cases'
                    }
                });
                userView.scale({
                    vacc: {
                        alias: 'Vaccination'
                    }
                });
                userView.scale({
                    vaccRate: {
                        alias: 'Vaccination Rate'
                    }
                });
                userView.scale({
                    population: {
                        alias: 'Population'
                    }
                });
                userView.scale({
                    populationRate: {
                        alias: 'Population Rate'
                    }
                });

                userView.scale({
                    RawPRateOnVRate: {
                        alias: 'Population Over Vaccination Rate'
                    }
                });

                userView.scale({
                    RawCRateOnVRate: {
                        alias: 'Cases Over Vaccination Rate'
                    }
                });
                userView.scale({
                    PRateMinusVRate: {
                        alias: 'Population minus Vaccination Rate'
                    }
                });

                userView.scale({
                    CRateMinusVRate: {
                        alias: 'Cases minus Vaccination Rate'
                    }
                });

                userView.polygon()
                    .position('longitude*latitude')
                    .color('PRateMinusVRate', ['#008A5D','#ffffff','#F51D27'])
                    .tooltip('name*cases*casesRate*vacc*vaccRate*population*populationRate*PRateMinusVRate')
                    .style({
                        fillOpacity: 0.85
                    })
                    .animate({
                        leave: {
                            animation: 'fade-out'
                        }
                    });
                userView.interaction('element-active');

                chart.render();
            });
    }
</script>
<script>
    function draw_vacc_phases() {
        topSecViewFigure = draw_vacc_phases
        $("#phases").html("")
        fetch('https://gist.githubusercontent.com/adamusmani95/e1e5134051640a2cbbf54261a59e4281/raw/47cc386c887a1bc375cd31647c1d32dd85fe0ff4/phases.json')
            .then((res) => res.json())
            .then((data) => {
                const linePlot = new G2Plot.Line('phases', {
                    data,
                    xField: 'Date',
                    yField: 'NoVaccines',
                    seriesField: 'Stage',
                    yAxis: {
                        label: {
                            // formatter: (v) => `${(v / 10e8).toFixed(1)} `,

                        },
                    },
                    legend: {
                        position: 'top',
                    },
                    smooth: true,
                    animation: {
                        appear: {
                            animation: 'path-in',
                            duration: 1000,
                        },
                    },
                });

                linePlot.render();
            });
    }
    draw_vacc_phases();
</script>
<script>
    function draw_vacc_stacked(){
        topSecViewFigure = draw_vacc_stacked
        $("#vacc-stacked").html("")
        const data = [
            { State: 'Replicating bacterial vector', 'Pre-Clinical': 2, 'Phase 1': 0, 'Phase 1&2': 0, 'Phase 2': 0, 'Phase 2&3': 0, 'Phase 3': 0, 'Approved': 0 },
            { State: 'Replicating viral vector', 'Pre-Clinical': 17, 'Phase 1': 2, 'Phase 1&2': 4, 'Phase 2': 0, 'Phase 2&3': 0, 'Phase 3': 0, 'Approved': 0 },
            { State: 'Non-replicating viral vector', 'Pre-Clinical': 18, 'Phase 1': 7, 'Phase 1&2': 1, 'Phase 2': 0, 'Phase 2&3': 0, 'Phase 3': 2, 'Approved': 2 },
            { State: 'Live attenuated virus', 'Pre-Clinical': 2, 'Phase 1': 2, 'Phase 1&2': 0, 'Phase 2': 0, 'Phase 2&3': 0, 'Phase 3': 0, 'Approved': 0 },
            { State: 'Inactivated virus', 'Pre-Clinical': 8, 'Phase 1': 1, 'Phase 1&2': 2, 'Phase 2': 2, 'Phase 2&3': 0, 'Phase 3': 7, 'Approved': 0 },
            { State: 'Virus-like particle', 'Pre-Clinical': 20, 'Phase 1': 0, 'Phase 1&2': 1, 'Phase 2': 0, 'Phase 2&3': 1, 'Phase 3': 0, 'Approved': 0 },
            { State: 'Protein subunit', 'Pre-Clinical': 59, 'Phase 1': 4, 'Phase 1&2': 9, 'Phase 2': 4, 'Phase 2&3': 1, 'Phase 3': 5, 'Approved': 0 },
            { State: 'RNA', 'Pre-Clinical': 23, 'Phase 1': 2, 'Phase 1&2': 4, 'Phase 2': 0, 'Phase 2&3': 0, 'Phase 3': 1, 'Approved': 2 },
            { State: 'DNA', 'Pre-Clinical': 13, 'Phase 1': 2, 'Phase 1&2': 3, 'Phase 2': 0, 'Phase 2&3': 2, 'Phase 3': 1, 'Approved': 0 },
        ];

        const ds = new DataSet.DataSet();
        const dv = ds.createView().source(data);
        dv.transform({
            type: 'fold',
            fields: ['Pre-Clinical', 'Phase 1', 'Phase 1&2', 'Phase 2', 'Phase 2&3', 'Phase 3', 'Approved'], // 展开字段集
            key: '年龄段', // key字段
            value: '人口数量', // value字段
            retains: ['State'], // 保留字段集，默认为除fields以外的所有字段
        });
        // 数据被加工成 {State: 'WY', 年龄段: '小于5岁', 人口数量: 25635}

        const chart = new G2.Chart({
            container: 'vacc-stacked',
            autoFit: true,
            height: 680,
        });

        chart.coordinate().transpose();

        chart.data(dv.rows);
        chart.scale('人口数量', { nice: true });

        chart.axis('State', {
            label: {
                offset: 12,
            },
        });

        chart.tooltip({
            shared: true,
            showMarkers: false,
        });

        chart
            .interval()
            .adjust('stack')
            .position('State*人口数量')
            .color('年龄段');

        chart.interaction('active-region');

        chart.theme({ "styleSheet": { "brandColor": "#025DF4", "paletteQualitative10": ["#025DF4", "#DB6BCF", "#2498D1", "#BBBDE6", "#4045B2", "#21A97A", "#FF745A", "#007E99", "#FFA8A8", "#2391FF"], "paletteQualitative20": ["#025DF4", "#DB6BCF", "#2498D1", "#BBBDE6", "#4045B2", "#21A97A", "#FF745A", "#007E99", "#FFA8A8", "#2391FF", "#FFC328", "#A0DC2C", "#946DFF", "#626681", "#EB4185", "#CD8150", "#36BCCB", "#327039", "#803488", "#83BC99"] } });
        chart.render();
    }
</script>
</body>

</html>
